---
title: 'Advanced Usage'
description: 'Advanced techniques and best practices for Cloud Coding API'
---

<Info>
  **Prerequisite**: Ensure you've completed the [Quickstart](/quickstart) and have your API keys configured.
</Info>

## Advanced API Patterns

### Streaming Response Handling

The Cloud Coding API returns streaming responses. Here's how to handle them in different languages:

#### JavaScript/Node.js
```javascript
const response = await fetch('https://api.cloudcoding.ai/invoke', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    'x-api-key': process.env.CLOUDCODING_API_KEY
  },
  body: JSON.stringify({
    repo_url: 'https://github.com/username/repo',
    github_token: process.env.GITHUB_TOKEN,
    branch: 'main',
    variables: { query: 'Add error handling to all functions' }
  })
});

const reader = response.body.getReader();
const decoder = new TextDecoder();

while (true) {
  const { done, value } = await reader.read();
  if (done) break;

  const chunk = decoder.decode(value);
  const lines = chunk.split('\n');

  for (const line of lines) {
    if (line.startsWith('data: ')) {
      const data = JSON.parse(line.slice(6));
      console.log('Received:', data);
    }
  }
}
```

#### Python
```python
import requests
import json
import os

response = requests.post(
    'https://api.cloudcoding.ai/invoke',
    headers={
        'Content-Type': 'application/json',
        'x-api-key': os.getenv('CLOUDCODING_API_KEY')
    },
    json={
        'repo_url': 'https://github.com/username/repo',
        'github_token': os.getenv('GITHUB_TOKEN'),
        'branch': 'main',
        'variables': {'query': 'Optimize database queries'}
    },
    stream=True
)

for line in response.iter_lines():
    if line.startswith(b'data: '):
        data = json.loads(line[6:])
        print('Received:', data)
```

### Template Usage Patterns

#### Complex Planning Tasks
For multi-step coding tasks, use the Plan and Execute template:

```bash
curl -X POST "https://api.cloudcoding.ai/invoke" \
  -H "Content-Type: application/json" \
  -H "x-api-key: $CLOUDCODING_API_KEY" \
  -d '{
    "repo_url": "https://github.com/username/large-project",
    "github_token": "'$GITHUB_TOKEN'",
    "branch": "feature/refactor",
    "template_id": "a2ef2e64-40e2-4c6a-99fc-767e3a30a963",
    "variables": {
      "task": "Migrate the entire codebase from JavaScript to TypeScript, ensuring type safety and maintaining all existing functionality"
    }
  }'
```

#### Batch Processing
Process multiple repositories efficiently:

```bash
#!/bin/bash

REPOS=(
  "https://github.com/user/repo1"
  "https://github.com/user/repo2"
  "https://github.com/user/repo3"
)

for repo in "${REPOS[@]}"; do
  echo "Processing $repo..."
  curl -X POST "https://api.cloudcoding.ai/invoke" \
    -H "Content-Type: application/json" \
    -H "x-api-key: $CLOUDCODING_API_KEY" \
    -d "{
      \"repo_url\": \"$repo\",
      \"github_token\": \"$GITHUB_TOKEN\",
      \"branch\": \"main\",
      \"variables\": {
        \"query\": \"Add comprehensive JSDoc comments to all functions\"
      }
    }"
done
```

## Response Types

Understanding the different response types helps you build better integrations:

### Authentication Response
```json
data: {"auth": "Authenticated Successfully!"}
```

### Setup Response
```json
data: {
  "setup": {
    "messages": [...],
    "repo_url": "https://github.com/username/repo",
    "branch": "main",
    "haiku": false,
    "working_dir": "./repo-name"
  }
}
```

### Executor Response
```json
data: {
  "executor": [
    {"type": "system", "subtype": "init", "tools": [...]},
    {"type": "assistant", "message": {...}},
    {"type": "user", "message": {...}}
  ]
}
```

### Push Response
```json
data: {"push": "changes successfully pushed to main"}
```

## Error Handling

### Common Error Patterns
```javascript
// Handle common API errors
const handleResponse = async (response) => {
  if (!response.ok) {
    const error = await response.text();

    if (response.status === 401) {
      throw new Error('Invalid API key');
    } else if (response.status === 403) {
      throw new Error('GitHub token permissions insufficient');
    } else if (response.status === 404) {
      throw new Error('Repository not found or inaccessible');
    } else {
      throw new Error(`API error: ${error}`);
    }
  }

  return response;
};
```

### Retry Logic
```javascript
const retryWithBackoff = async (fn, maxRetries = 3) => {
  for (let i = 0; i < maxRetries; i++) {
    try {
      return await fn();
    } catch (error) {
      if (i === maxRetries - 1) throw error;

      const delay = Math.pow(2, i) * 1000; // Exponential backoff
      await new Promise(resolve => setTimeout(resolve, delay));
    }
  }
};
```

## Performance Optimization

### Choose the Right Model
- **Claude Sonnet**: Use for complex reasoning and large codebases
- **Claude Haiku**: Use for simple tasks, documentation, and quick fixes

### Optimize Repository Access
```bash
# For large repositories, specify working_dir to focus on specific areas
curl -X POST "https://api.cloudcoding.ai/invoke" \
  -H "Content-Type: application/json" \
  -H "x-api-key: $CLOUDCODING_API_KEY" \
  -d '{
    "repo_url": "https://github.com/username/monorepo",
    "github_token": "'$GITHUB_TOKEN'",
    "branch": "main",
    "working_dir": "./packages/frontend",
    "variables": {
      "query": "Add React TypeScript types to all components"
    }
  }'
```

## Best Practices

### 1. Use Descriptive Branches
```bash
# Create feature branches for AI changes
git checkout -b ai/add-error-handling
# Then specify this branch in your API call
```

### 2. Provide Context in Queries
```json
{
  "variables": {
    "query": "Add comprehensive error handling to the user authentication system. Focus on the login, signup, and password reset flows. Ensure all errors are properly logged and user-friendly messages are displayed."
  }
}
```

### 3. Monitor Usage
Track your API usage and costs by monitoring the response data and your Anthropic bill.

### 4. Secure Your Keys
- Never commit API keys to version control
- Use environment variables or secure secret management
- Rotate keys regularly

## Integration Examples

### GitHub Actions
```yaml
name: AI Code Review
on:
  pull_request:
    branches: [main]

jobs:
  ai-review:
    runs-on: ubuntu-latest
    steps:
      - name: AI Code Analysis
        run: |
          curl -X POST "https://api.cloudcoding.ai/invoke" \
            -H "Content-Type: application/json" \
            -H "x-api-key: ${{ secrets.CLOUDCODING_API_KEY }}" \
            -d '{
              "repo_url": "'$GITHUB_REPOSITORY'",
              "github_token": "${{ secrets.GITHUB_TOKEN }}",
              "branch": "'$GITHUB_HEAD_REF'",
              "variables": {
                "query": "Review this pull request for potential bugs and suggest improvements"
              }
            }'
```

### Webhook Integration
Set up webhooks to automatically trigger Cloud Coding on repository events like new commits or PR creation.
