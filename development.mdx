---
title: 'Advanced Usage'
description: 'Advanced techniques and best practices for Cloud Coding API'
---

<Info>
  **Prerequisite**: Ensure you've completed the [Quickstart](/quickstart) and have your API keys configured.
</Info>

## Custom Messages: Script Your AI Agent

The Cloud Coding API's most powerful feature is **custom messages** - allowing you to script exactly how the AI agent behaves. Instead of using pre-built templates, you can define precise conversation flows, control tool usage, and customize the execution environment.

### Quick Start Example

Here's a simple example to get you started:

```bash
curl -X POST "https://api.cloudcoding.ai/invoke" \
  -H "Content-Type: application/json" \
  -H "x-api-key: $CLOUDCODING_API_KEY" \
  -d '{
    "messages": [
      {
        "tools": "all",
        "content": "Analyze this repository and add comprehensive error handling to all functions"
      }
    ],
    "repo_url": "https://github.com/username/repo",
    "github_token": "'$GITHUB_TOKEN'",
    "branch": "main",
    "haiku": true
  }'
```

### Why Use Custom Messages?

- üéØ **Complete Control**: Script exact conversation flows and agent behavior
- üîß **Tool Selection**: Choose specific tools for each step of your workflow
- üêç **Custom Environment**: Run your own Python code before AI execution
- üìÅ **Directory Focus**: Limit the agent's scope to specific repository parts
- üîÑ **Conversation Flow**: Continue previous contexts or start fresh sessions

## Message Structure

Each message in the `messages` array supports these fields:

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `content` | string | ‚úÖ Yes | The instruction/prompt for the AI agent |
| `tools` | string/array | ‚ùå No | Available tools: `"all"` or specific tool names |
| `continueConversation` | boolean | ‚ùå No | Continue previous conversation context |
| `workingDir` | string | ‚ùå No | Custom working directory for this message |
| `customInitCode` | string | ‚ùå No | Python code to execute before AI initialization |

## Progressive Examples

### 1. Simple Single Task

Perfect for straightforward development tasks:

```bash
curl -X POST "https://api.cloudcoding.ai/invoke" \
  -H "Content-Type: application/json" \
  -H "x-api-key: $CLOUDCODING_API_KEY" \
  -d '{
    "messages": [
      {
        "tools": "all",
        "content": "Add a dark mode toggle to this React application"
      }
    ],
    "repo_url": "https://github.com/username/my-app",
    "github_token": "'$GITHUB_TOKEN'",
    "branch": "feature/dark-mode",
    "haiku": true
  }'
```

### 2. Multi-Step Workflow

Chain related tasks with conversation continuity:

```bash
curl -X POST "https://api.cloudcoding.ai/invoke" \
  -H "Content-Type: application/json" \
  -H "x-api-key: $CLOUDCODING_API_KEY" \
  -d '{
    "messages": [
      {
        "tools": "all",
        "content": "Analyze the current authentication system and identify security improvements"
      },
      {
        "tools": "all",
        "content": "Now implement the security improvements you identified",
        "continueConversation": true
      },
      {
        "tools": "all",
        "content": "Add comprehensive tests for the updated authentication system",
        "continueConversation": true
      }
    ],
    "repo_url": "https://github.com/username/secure-app",
    "github_token": "'$GITHUB_TOKEN'",
    "branch": "security/auth-improvements",
    "haiku": false
  }'
```

### 3. Tool-Specific Operations

Control exactly which tools are used at each step:

```bash
curl -X POST "https://api.cloudcoding.ai/invoke" \
  -H "Content-Type: application/json" \
  -H "x-api-key: $CLOUDCODING_API_KEY" \
  -d '{
    "messages": [
      {
        "tools": ["Read", "LS", "Grep"],
        "content": "First, explore and understand the project structure without making any changes"
      },
      {
        "tools": ["Edit", "Write"],
        "content": "Now refactor the main component based on your analysis",
        "continueConversation": true
      },
      {
        "tools": ["Bash"],
        "content": "Run tests to ensure all changes work correctly",
        "continueConversation": true
      }
    ],
    "repo_url": "https://github.com/username/react-app",
    "github_token": "'$GITHUB_TOKEN'",
    "branch": "refactor/components",
    "haiku": true
  }'
```

### 4. Custom Environment Setup

Run your own Python code before AI execution:

```bash
curl -X POST "https://api.cloudcoding.ai/invoke" \
  -H "Content-Type: application/json" \
  -H "x-api-key: $CLOUDCODING_API_KEY" \
  -d '{
    "messages": [
      {
        "tools": "all",
        "content": "Set up comprehensive testing for this Node.js application",
        "customInitCode": "import os\nimport datetime\n\nstart_time = datetime.datetime.now()\nprint(f\"üöÄ Test setup started at {start_time}\")\n\ndef log_progress(msg):\n    elapsed = datetime.datetime.now() - start_time\n    print(f\"‚è±Ô∏è  [{elapsed}] {msg}\")\n\nlog_progress(\"Environment setup complete\")"
      }
    ],
    "repo_url": "https://github.com/username/node-api",
    "github_token": "'$GITHUB_TOKEN'",
    "branch": "testing/comprehensive",
    "haiku": true
  }'
```

### 5. Directory-Focused Development

Focus the agent on specific parts of your repository:

```bash
curl -X POST "https://api.cloudcoding.ai/invoke" \
  -H "Content-Type: application/json" \
  -H "x-api-key: $CLOUDCODING_API_KEY" \
  -d '{
    "messages": [
      {
        "tools": "all",
        "content": "Migrate all components to TypeScript with proper type definitions",
        "workingDir": "./src/components"
      },
      {
        "tools": "all",
        "content": "Now update the hooks to use TypeScript interfaces",
        "workingDir": "./src/hooks",
        "continueConversation": true
      },
      {
        "tools": "all",
        "content": "Finally, update the API layer with TypeScript types",
        "workingDir": "./src/api",
        "continueConversation": true
      }
    ],
    "repo_url": "https://github.com/username/typescript-migration",
    "github_token": "'$GITHUB_TOKEN'",
    "branch": "migration/typescript",
    "haiku": false
  }'
```

## Advanced Features

### Available Tools

Based on the system capabilities, you can specify these tools:

| Tool Name | Description |
|-----------|-------------|
| `"all"` | All available tools (recommended for most cases) |
| `"Task"` | Task management and planning |
| `"Bash"` | Execute shell commands |
| `"Glob"` | File pattern matching |
| `"Grep"` | Text search and pattern matching |
| `"LS"` | Directory listing and navigation |
| `"Read"` | Read file contents |
| `"Edit"` | Edit existing files |
| `"MultiEdit"` | Edit multiple files simultaneously |
| `"Write"` | Create new files |
| `"NotebookRead"` | Read Jupyter notebooks |
| `"NotebookEdit"` | Edit Jupyter notebooks |
| `"WebFetch"` | Fetch web content |
| `"TodoRead"` | Read todo lists |
| `"TodoWrite"` | Manage todo lists |
| `"WebSearch"` | Search the web for information |

### Custom Python Code Execution

The `customInitCode` field runs Python code before the AI agent starts:

```json
{
  "customInitCode": "import subprocess\nimport json\n\n# Environment validation\nnode_result = subprocess.run(['node', '--version'], capture_output=True, text=True)\nprint(f'Node.js: {node_result.stdout.strip()}')\n\n# Helper functions\ndef backup_file(filename):\n    print(f'Creating backup of {filename}')\n    # Your backup logic here\n\n# Project configuration\nconfig = {'framework': 'React', 'typescript': True}\nprint(f'Project config: {config}')"
}
```

**Common Use Cases:**
- Environment validation and setup
- Helper function definitions
- Pre-execution logging and monitoring
- Configuration and variable setup
- External tool version checks

### Response Format

The API returns Server-Sent Events (SSE) with these event types:

1. **Authentication**: `{"auth": "Authenticated Successfully!"}`
2. **Setup**: Configuration and repository information
3. **Executor**: Agent conversation and tool usage
4. **Push**: Final commit and push status

## Complex Workflow Patterns

### Plan and Execute Pattern

Perfect for large, complex features:

```bash
curl -X POST "https://api.cloudcoding.ai/invoke" \
  -H "Content-Type: application/json" \
  -H "x-api-key: $CLOUDCODING_API_KEY" \
  -d '{
    "messages": [
      {
        "tools": "all",
        "content": "Create a comprehensive plan in plan.md for implementing user authentication with JWT, password reset, and two-factor authentication. Include all necessary files, dependencies, and implementation steps."
      },
      {
        "tools": "all",
        "content": "Implement the authentication system according to the detailed plan in plan.md. Create all backend APIs, database schemas, and security middleware.",
        "continueConversation": true
      },
      {
        "tools": "all",
        "content": "Now implement the frontend authentication components, forms, and state management to integrate with the backend APIs.",
        "continueConversation": true
      },
      {
        "tools": "all",
        "content": "Add comprehensive tests for both backend and frontend authentication features, including edge cases and security scenarios.",
        "continueConversation": true
      }
    ],
    "repo_url": "https://github.com/username/full-auth-system",
    "github_token": "'$GITHUB_TOKEN'",
    "branch": "feature/complete-auth",
    "haiku": false
  }'
```

### Code Migration Workflow

For large-scale code transformations:

```bash
curl -X POST "https://api.cloudcoding.ai/invoke" \
  -H "Content-Type: application/json" \
  -H "x-api-key: $CLOUDCODING_API_KEY" \
  -d '{
    "messages": [
      {
        "tools": ["Read", "LS", "Grep"],
        "content": "Analyze the entire JavaScript codebase and create a migration plan for converting to TypeScript. Identify all files that need conversion and potential type challenges."
      },
      {
        "tools": ["Edit", "Write"],
        "content": "Start with the utility functions and core modules - convert them to TypeScript with proper type definitions and interfaces.",
        "continueConversation": true
      },
      {
        "tools": ["Edit", "Write"],
        "content": "Convert the React components to TypeScript, ensuring proper prop types, state types, and event handler types.",
        "continueConversation": true
      },
      {
        "tools": ["Bash"],
        "content": "Run TypeScript compiler to check for errors and fix any type issues that arise.",
        "continueConversation": true
      },
      {
        "tools": ["Bash"],
        "content": "Update build scripts and run the full test suite to ensure the migration is successful.",
        "continueConversation": true
      }
    ],
    "repo_url": "https://github.com/username/js-to-ts-migration",
    "github_token": "'$GITHUB_TOKEN'",
    "branch": "migration/typescript-conversion",
    "haiku": false
  }'
```

## Streaming Response Handling

### JavaScript/Node.js
```javascript
const response = await fetch('https://api.cloudcoding.ai/invoke', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    'x-api-key': process.env.CLOUDCODING_API_KEY
  },
  body: JSON.stringify({
    messages: [
      {
        tools: "all",
        content: "Add comprehensive error handling to all API endpoints"
      }
    ],
    repo_url: 'https://github.com/username/repo',
    github_token: process.env.GITHUB_TOKEN,
    branch: 'main',
    haiku: true
  })
});

const reader = response.body.getReader();
const decoder = new TextDecoder();

while (true) {
  const { done, value } = await reader.read();
  if (done) break;

  const chunk = decoder.decode(value);
  const lines = chunk.split('\n');

  for (const line of lines) {
    if (line.startsWith('data: ')) {
      const data = JSON.parse(line.slice(6));
      console.log('Event:', data);
    }
  }
}
```

### Python
```python
import requests
import json
import os

response = requests.post(
    'https://api.cloudcoding.ai/invoke',
    headers={
        'Content-Type': 'application/json',
        'x-api-key': os.getenv('CLOUDCODING_API_KEY')
    },
    json={
        'messages': [
            {
                'tools': 'all',
                'content': 'Optimize database queries and add proper indexing'
            }
        ],
        'repo_url': 'https://github.com/username/repo',
        'github_token': os.getenv('GITHUB_TOKEN'),
        'branch': 'main',
        'haiku': True
    },
    stream=True
)

for line in response.iter_lines():
    if line.startswith(b'data: '):
        data = json.loads(line[6:])
        print('Event:', data)
```

## Error Handling

### Common Error Patterns
```javascript
const handleResponse = async (response) => {
  if (!response.ok) {
    const error = await response.text();

    if (response.status === 401) {
      throw new Error('Invalid API key');
    } else if (response.status === 403) {
      throw new Error('GitHub token permissions insufficient');
    } else if (response.status === 404) {
      throw new Error('Repository not found or inaccessible');
    } else {
      throw new Error(`API error: ${error}`);
    }
  }

  return response;
};
```

### Retry Logic
```javascript
const retryWithBackoff = async (fn, maxRetries = 3) => {
  for (let i = 0; i < maxRetries; i++) {
    try {
      return await fn();
    } catch (error) {
      if (i === maxRetries - 1) throw error;

      const delay = Math.pow(2, i) * 1000; // Exponential backoff
      await new Promise(resolve => setTimeout(resolve, delay));
    }
  }
};
```

## Performance Optimization

### Choose the Right Model
- **Claude Sonnet** (`"haiku": false`): Use for complex reasoning and large codebases
- **Claude Haiku** (`"haiku": true`): Use for simple tasks, documentation, and quick fixes

### Optimize Repository Access
```bash
# For large repositories, use workingDir to focus on specific areas
curl -X POST "https://api.cloudcoding.ai/invoke" \
  -H "Content-Type: application/json" \
  -H "x-api-key: $CLOUDCODING_API_KEY" \
  -d '{
    "messages": [
      {
        "tools": "all",
        "content": "Add React TypeScript types to all components",
        "workingDir": "./packages/frontend"
      }
    ],
    "repo_url": "https://github.com/username/monorepo",
    "github_token": "'$GITHUB_TOKEN'",
    "branch": "main",
    "haiku": true
  }'
```

## Integration Examples

### GitHub Actions
```yaml
name: AI Code Review
on:
  pull_request:
    branches: [main]

jobs:
  ai-review:
    runs-on: ubuntu-latest
    steps:
      - name: AI Code Analysis
        run: |
          curl -X POST "https://api.cloudcoding.ai/invoke" \
            -H "Content-Type: application/json" \
            -H "x-api-key: ${{ secrets.CLOUDCODING_API_KEY }}" \
            -d '{
              "messages": [
                {
                  "tools": ["Read", "Grep", "WebSearch"],
                  "content": "Review this pull request for potential bugs, security issues, and code quality improvements"
                }
              ],
              "repo_url": "'$GITHUB_REPOSITORY'",
              "github_token": "${{ secrets.GITHUB_TOKEN }}",
              "branch": "'$GITHUB_HEAD_REF'",
              "haiku": true
            }'
```

Custom messages give you unprecedented control over AI-powered development workflows. Start with simple single-message tasks and gradually build more complex, multi-step workflows as you become comfortable with the system.